<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>VR Explorer</title>

<link rel="manifest" href="/ExplorerTest9/manifest.json">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="VR Explorer">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="/ExplorerTest9/icons/icon-192.png">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #000;
    color: #fff;
    text-align: center;
}
.container {
    margin-top: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
h1 { font-size: 2.8rem; margin-bottom: 10px; }
h2 { margin-top: 20px; font-size: 1.6rem; font-weight: 600; }
label { display: block; margin-top: 15px; font-size: 1rem; color: #dfeeff; text-align: center; }
select { width: 80%; max-width: 350px; padding: 14px; margin-top: 6px; font-size: 1.2rem; border-radius: 10px; border: none; outline: none; background: #111; color: white; appearance: none; cursor: pointer; background-image: linear-gradient(45deg, transparent 50%, #555 50%), linear-gradient(135deg, #555 50%, transparent 50%), linear-gradient(to right, #555, #555); background-position: calc(100% - 20px) calc(1.2em), calc(100% - 15px) calc(1.2em), calc(100% - 2.5em) 0.5em; background-size: 6px 6px, 6px 6px, 1px 1.5em; background-repeat: no-repeat; }
.or-text { margin: 12px 0; font-size: 1rem; color: #dfeeff; }
button#openBtn { margin-top: 12px; padding: 15px 25px; font-size: 1.3rem; color: #fff; border: none; border-radius: 12px; cursor: pointer; width: 80%; max-width: 350px; background-color: #555; }
button#openBtn.active { background-color: #28a745; }
footer { margin-top: 40px; font-size: 0.75rem; font-style: italic; opacity: 0.8; margin-bottom: 20px; }

#playerWrap { position: fixed; inset: 0; display: none; background: #000; z-index: 1000; align-items: center; justify-content: center; flex-direction: column; }
#playerWrap iframe { width: 100%; height: 100%; border: 0; }

#safeModeToggle {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 15px;
}
/* Modern toggle switch */
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 30px;
}
.switch input { display: none; }
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #555;
  transition: 0.4s;
  border-radius: 30px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 22px;
  width: 22px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: 0.4s;
  border-radius: 50%;
}
input:checked + .slider { background-color: #28a745; }
input:checked + .slider:before { transform: translateX(30px); }
</style>
</head>
<body>

<div class="container" id="home">
    <h1>VR Explorer</h1>
    <h2>Step 1: Select Simulation</h2>

    <label for="audienceSelect">Audience Sizes:</label>
    <select id="audienceSelect">
        <option value="" selected disabled>--select option--</option>
    </select>

    <div class="or-text">or</div>

    <label for="scenarioSelect">Special Scenarios:</label>
    <select id="scenarioSelect">
        <option value="" selected disabled>--select option--</option>
    </select>

    <h2>Step 2: Enter Simulation</h2>
    <button id="openBtn">Go</button>

    <div id="safeModeToggle">
      <label class="switch">
        <input type="checkbox" id="safeMode">
        <span class="slider"></span>
      </label>
      <span style="margin-left:10px;color:#dfeeff;">Android Safe Mode</span>
    </div>

    <footer>VR Explorer 1.1 brought to you by Cambridge VR</footer>
</div>

<div id="playerWrap"></div>

<script>
// ------------------- VIDEO DATA -------------------
const videos = {
  "Audience of 0": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N0-CF", ytLink: "https://www.youtube.com/watch?v=8D5ZJjV-9No" },
  "Audience of 1": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N1-CF", ytLink: "https://www.youtube.com/watch?v=L61TY-lVWYc" },
  "Audience of 2": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N2-CF", ytLink: "https://www.youtube.com/watch?v=jisLJabMOaw" },
  "Audience of 4": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N4-CF", ytLink: "https://www.youtube.com/watch?v=583YioSTgGE" },
  "Audience of 9": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N9-CF", ytLink: "https://www.youtube.com/watch?v=7AS7NEA9PFo" },
  "Audience of 16": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N16-CF", ytLink: "https://www.youtube.com/watch?v=_y-lSw1SNaU" },
  "Audience of 25": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N25-CF", ytLink: "https://www.youtube.com/watch?v=CBBwXbX5ogE" },
  "Audience of 50": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N50-CF", ytLink: "https://www.youtube.com/watch?v=RUnKCfWFSfI" },
  "Audience of 100": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N100-CF", ytLink: "https://www.youtube.com/watch?v=ww986pYF46E" },
  "Audience of 500": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N500-CF", ytLink: "https://www.youtube.com/watch?v=S3Ve7FGfjWk" },
  "Audience of 1000s": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=N10K-CF", ytLink: "https://www.youtube.com/watch?v=jyUNFPBmJkA" },
  "TV teleprompter": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=ACC01-CF", ytLink: "https://www.youtube.com/watch?v=3ZNddx_YNc0" },
  "Job interview": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=JIC01-CF", ytLink: "https://www.youtube.com/watch?v=-tsxJfabw0s" },
  "Radio interview": { vrLink: "https://player.virtualrealitypublicspeaking.com/?video=RIC01-CF", ytLink: "https://www.youtube.com/watch?v=sE3pahN4BwI" }
};

// ------------------- POPULATE DROPDOWNS -------------------
const audienceSel = document.getElementById("audienceSelect");
const scenarioSel = document.getElementById("scenarioSelect");
Object.keys(videos).forEach(name=>{
    if(name.startsWith("Audience")) {
        const opt = document.createElement("option");
        opt.value = name; opt.textContent = name; audienceSel.appendChild(opt);
    } else {
        const opt = document.createElement("option");
        opt.value = name; opt.textContent = name; scenarioSel.appendChild(opt);
    }
});

// ------------------- VARIABLES -------------------
const openBtn = document.getElementById("openBtn");
const safeModeCheck = document.getElementById("safeMode");
const playerWrap = document.getElementById("playerWrap");
let selectedVideoKey = "";

// ------------------- UPDATE SELECTION -------------------
function updateSelection() {
    const audience = audienceSel.value;
    const scenario = scenarioSel.value;
    selectedVideoKey = audience || scenario;
    if(selectedVideoKey) openBtn.classList.add("active");
    else openBtn.classList.remove("active");
}

audienceSel.addEventListener("change", ()=>{ scenarioSel.value=""; updateSelection(); });
scenarioSel.addEventListener("change", ()=>{ audienceSel.value=""; updateSelection(); });

// ------------------- OPEN VIDEO -------------------
openBtn.addEventListener("click", ()=>{
    if(!selectedVideoKey) return;
    const video = videos[selectedVideoKey];

    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    const isAndroid = /Android/.test(navigator.userAgent);

    if(safeModeCheck.checked && isAndroid){
        // ---------------- SAFE MODE: redirect to YouTube ----------------
        window.open(video.ytLink, "_blank");
    } else {
        // ---------------- DEFAULT VR ----------------
        if(isIOS){
            // open in Safari
            window.open(video.vrLink, "_blank");
        } else {
            // Android / desktop iframe
            playerWrap.innerHTML = `<iframe src="${video.vrLink}" allow="autoplay; fullscreen; accelerometer; gyroscope; xr-spatial-tracking"></iframe>
                                    <button onclick="closePlayer()" style="position:absolute;top:10px;right:10px;z-index:1001;padding:10px 15px;font-size:1rem;border:none;border-radius:8px;cursor:pointer;">Exit VR</button>`;
            playerWrap.style.display = "flex";
        }
    }
});

// ------------------- CLOSE PLAYER -------------------
function closePlayer(){
    playerWrap.style.display="none";
    playerWrap.innerHTML="";
}

// ------------------- SERVICE WORKER -------------------
if("serviceWorker" in navigator){
    navigator.serviceWorker.register("/ExplorerTest9/sw.js");
}
</script>

</body>
</html>
